{% extends 'header.html' %}
{% load static %}
{% block title %}시험결과서 자동 검토{% endblock %}

{% block head %}
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js" defer></script>

<link rel="stylesheet" href="{% static 'css/review/checkreport.css' %}"/>
<link rel="stylesheet" href="{% static 'css/review/checkreport_table.css' %}"/>
<link rel="stylesheet" href="{% static 'css/helpbtn.css' %}"/>

<script src="{% static 'scripts/review/checkreport_submit.js' %}" defer></script>
<script src="{% static 'scripts/review/checkreport_table.js' %}" defer></script>
{% endblock %}

{% block content %}
<div class="app-container">
  <div class="main-content">
    <div class="sidebar-container">
      <div class="search-title">
        <i class="fas fa-search search-icon"></i> 시험결과서 자동 검토
        <span class="tooltip">ⓘ
          <span class="tooltiptext upload">시험결과서를 2가지 확장자(docx, pdf)로<br/>업로드 해주세요.</span>
        </span>
      </div>
      <div class="sidebar">
        <form id="queryForm" method="post" enctype="multipart/form-data">
          {% csrf_token %}
          <div class="file-upload-container">
            <div class="content-container" id="content-auto">
              <input class="file-input" id="fileInput" type="file" name="file" multiple accept=".docx, .pdf"/>

              <div class="drop-area" id="dropArea">
                <i class="fas fa-cloud-upload-alt text-3xl text-blue-400"></i>
                <p>파일을 이곳에 드래그하거나</p>
                <p><span class="text-blue-500 font-medium">클릭</span>하여 업로드하세요</p>
                <p class="upload-limit-message">* docx, pdf 파일을 업로드 해주세요.</p>
              </div>

              <div class="file-list hidden" id="fileList"></div>

              <div class="content-spacer"></div>
              <!-- 페이지 이동 방지: type="button" -->
              <button type="button" class="action-button" id="btn-generate">시험결과서 자동 검토</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- 우측 콘텐츠 영역 -->
  <div class="content-card">
    <div class="results-container">
      <div class="results-header flex flex-wrap items-center justify-between gap-3">
        <div class="results-title">
          <div class="results-title">시험결과서 자동 검토 결과</div>
          <span class="tooltip">ⓘ
            <span class="tooltiptext result">GPT-5를 호출하고 있습니다.<br/>2~5분까지 소요될 수 있습니다.<br/>오류메시지가 발생하지 않으면 기다려주세요.</span>
          </span>
        </div>
        <div class="flex items-center space-x-3">
          <span class="text-sm text-gray-600">
            총 <span id="totalCount" class="font-semibold text-sky-700">0</span>개 항목
          </span>
        </div>
      </div>

      <div class="tab-content" id="resultSheetContent">
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 table-container">
          <div class="overflow-x-auto">
            <table id="resultsTable" class="min-w-full divide-y divide-gray-200 hidden">
              <thead class="bg-gray-50">
                <tr id="tableHeader">
                  <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">번호</th>
                  <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">구분(점검항목)</th>
                  <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">심각도</th>
                  <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">위치(표/절/문장)</th>
                  <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">문제 요약</th>
                  <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">근거(원문 일부 인용)</th>
                  <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">권장 수정안</th>
                </tr>
              </thead>
              <tbody id="tableBody" class="bg-white divide-y divide-gray-200"></tbody>
            </table>
          </div>

          <!-- 로딩 상태: 초기 숨김 -->
          <div id="loadingState" class="text-center py-12 hidden">
            <div class="loading-container" id="loadingContainer">
                <div class="spinner"></div>
                <div class="loading-text">분석 중...</div>
                <div class="loading-description">오류가 있는지 검토 중입니다...<BR/>2~4분 정도 소요될 수 있습니다.</div>
            </div>
          </div>

          <!-- 빈 상태: 초기 표시 -->
          <div id="emptyState" class="text-center py-12">
            <i class="fas fa-check-circle text-green-300 text-4xl mb-4"></i>
            <p class="text-gray-500 text-lg mb-2 font-semibold">표시할 결과가 없습니다.</p>
            <p class="text-gray-400 text-sm">문서를 업로드하고 ‘시험결과서 자동 검토’를 눌러 시작하세요.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
