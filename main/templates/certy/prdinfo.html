{% extends 'header.html' %}
{% load static %}
{% block title %}제품 정보 요청 엑셀{% endblock %}

{% block head %}
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet"/>

<!-- SheetJS -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<!-- Luckysheet -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/luckysheet@2.1.13/dist/plugins/css/pluginsCss.css"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/luckysheet@2.1.13/dist/plugins/plugins.css"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/luckysheet@2.1.13/dist/css/luckysheet.css"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/luckysheet@2.1.13/dist/assets/iconfont/iconfont.css"/>
<script src="https://cdn.jsdelivr.net/npm/luckysheet@2.1.13/dist/plugins/js/plugin.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/luckysheet@2.1.13/dist/luckysheet.umd.js" defer></script>

<!-- ✅ LuckyExcel -->
<script src="https://cdn.jsdelivr.net/npm/luckyexcel@1.0.1/dist/luckyexcel.umd.js" defer></script>

<link rel="stylesheet" href="{% static 'css/certy/prdinfo.css' %}"/>
<link rel="stylesheet" href="{% static 'css/certy/prdinfo_tab.css' %}"/>
<link rel="stylesheet" href="{% static 'css/helpbtn.css' %}"/>

<!-- 페이지 스크립트 -->
<script src="{% static 'scripts/certy/prdinfo_tab.js' %}" defer></script>
<script src="{% static 'scripts/certy/prdinfo_Luckysheet.js' %}" defer></script>
<script src="{% static 'scripts/certy/prdinfo_upload.js' %}" defer></script>
<script src="{% static 'scripts/certy/prdinfo_generate.js' %}" defer></script>
<script src="{% static 'scripts/certy/prdinfo_fill_cells.js' %}" defer></script>
<script src="{% static 'scripts/certy/prdinfo_download.js' %}" defer></script>
{% endblock %}

{% block content %}
<div class="app-container">
  <div class="main-content">
    <div class="sidebar-container">
      <div class="search-title">
        <i class="fas fa-search search-icon"></i> 제품 정보 요청 자동 작성
        <span class="tooltip">ⓘ
          <span class="tooltiptext upload">시험성적서, 시험합의서, 결함리포트 파일을 업로드 하시면<br/>제품 정보 요청 엑셀 파일을 만들어 드립니다.</span>
        </span>
      </div>
      <div class="sidebar">
        <form id="queryForm" method="post" enctype="multipart/form-data">
          {% csrf_token %}
          <div class="file-upload-container">
            <div class="content-container" id="content-auto">
              <input class="file-input" id="fileInput" type="file" name="file" multiple accept=".pdf,.docx,.xlsx"/>

              <div class="drop-area" id="dropArea">
                <i class="fas fa-cloud-upload-alt text-3xl text-blue-400"></i>
                <p>파일을 이곳에 드래그하거나</p>
                <p><span class="text-blue-500 font-medium">클릭</span>하여 업로드하세요</p>
                <p class="upload-limit-message">* pdf, docx, xlsx 파일을 업로드 해주세요.<br/>(최대 3개)</p>
              </div>

              <div class="file-list hidden" id="fileList"></div>

              <div class="content-spacer"></div>
              <!-- 페이지 이동 방지: type="button" -->
              <button type="button" class="action-button" id="btn-generate">제품 정보 요청 엑셀 파일 생성</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

<!-- 우측 콘텐츠 영역 -->
  <main class="content-area">
    <div class="content-card">
      <div class="loading-container hidden" id="loadingContainer">
        <div class="spinner"></div>
        <div class="loading-text">분석 중...</div>
        <div class="loading-description">제품 정보 요청 엑셀 파일을 생성하고 있습니다.</div>
      </div>
      <div class="results-container">
        <div class="results-header">
          <div style="display: flex;">
            <div class="results-title">제품 정보 요청 엑셀 파일</div>
            <span class="tooltip">ⓘ
              <span class="tooltiptext result">처음 자동 입력 시에는 한줄로 보이지만<br/>엑셀로 다운로드하시면 여러 줄로 작성됩니다.<br/>(회사명, 제품명 등 2줄 이상 작성되는 값들)</span>
            </span>
          </div>
          <button type="button" class="action-button download" id="btn-download">다운로드</button>
        </div>
        
        <!-- 탭 컨테이너 -->
        <div class="main-tab-container">
          <div class="main-tab active" data-tab="preInput">사전 입력 사항</div>
          <div class="main-tab" data-tab="resultSheet">결과 시트</div>
        </div>

        <!-- 사전 입력 사항 탭 내용 -->
        <div class="tab-content active" id="preInputContent">
          <div class="input-form-container">
            
            <!-- 클라우드 환경 구성 섹션 -->
            <div class="form-section">
              <div class="form-item">
                <div class="form-input-group">
                  <label class="form-label">클라우드 환경 구성</label>
                  <div class="radio-group">
                    <div class="radio-item">
                      <input type="radio" id="cloud_yes" name="cloud_config" value="yes">
                      <label for="cloud_yes">O</label>
                    </div>
                    <div class="radio-item">
                      <input type="radio" id="cloud_no" name="cloud_config" value="no" checked>
                      <label for="cloud_no">X</label>
                    </div>
                  </div>
                </div>
                
                <div class="sub-section hidden-section" id="cloudEnvironmentSection">
                  <div class="sub-label">시험환경</div>
                  <textarea class="form-textarea" id="testEnvironment" placeholder="예: 모니터링 서버가 AWS 환경으로 구성됨"></textarea>
                </div>
              </div>
            </div>

            <!-- SaaS형 제품 섹션 -->
            <div class="form-section">
              <div class="form-item">
                <div class="form-input-group">
                  <label class="form-label">SaaS형 제품</label>
                  <div class="radio-group">
                    <div class="radio-item">
                      <input type="radio" id="saas_yes" name="saas_config" value="yes">
                      <label for="saas_yes">O</label>
                    </div>
                    <div class="radio-item">
                      <input type="radio" id="saas_no" name="saas_config" value="no" checked>
                      <label for="saas_no">X</label>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- 재인증 여부 섹션 -->
            <div class="form-section">
              <div class="form-item">
                <div class="form-input-group">
                  <label class="form-label">재인증 구분</label>
                  <select class="form-select" id="reCertType">
                    <option value="해당사항 없음">해당사항 없음</option>
                    <option value="간소화 재인증(품질 개선)">간소화 재인증(품질 개선)</option>
                    <option value="간소화 재인증(부분 변경)">간소화 재인증(부분 변경)</option>
                    <option value="중요 변경 재인증">중요 변경 재인증</option>
                  </select>
                </div>

                <div class="sub-section hidden-section" id="reCertSection1">
                  <div class="sub-label">기 인증번호</div>
                  <textarea class="form-textarea" id="reCert1"></textarea>
                </div>
                <div class="sub-section hidden-section" id="reCertSection2">
                  <div class="sub-label">기 인증 제품명 및 버전</div>
                  <textarea class="form-textarea" id="reCert2"></textarea>
                </div>
                <div class="sub-section hidden-section" id="reCertSection3">
                  <div class="sub-label">기 인증 제품 WD</div>
                  <textarea class="form-textarea" id="reCert3"></textarea>
                </div>
                
              </div>
            </div>

            <!-- 보안성 시험 면제 여부 섹션 -->
            <div class="form-section">
              <div class="form-item">
                <div class="form-input-group">
                  <label class="form-label">보안성 시험 면제 여부</label>
                  <div class="radio-group">
                    <div class="radio-item">
                      <input type="radio" id="security_yes" name="security_config" value="yes">
                      <label for="security_yes">O</label>
                    </div>
                    <div class="radio-item">
                      <input type="radio" id="security_no" name="security_config" value="no" checked>
                      <label for="security_no">X</label>
                    </div>
                  </div>
                </div>
                
                <div class="sub-section hidden-section" id="securitySection1">
                  <div class="sub-label">보안 인증 종류</div>
                  <textarea class="form-textarea" id="security1"></textarea>
                </div>
                <div class="sub-section hidden-section" id="securitySection2">
                  <div class="sub-label">인증번호</div>
                  <textarea class="form-textarea" id="security2"></textarea>
                </div>
                <div class="sub-section hidden-section" id="securitySection3">
                  <div class="sub-label">인증일</div>
                  <textarea class="form-textarea" id="security3"></textarea>
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- 결과 시트 탭 내용 -->
        <div class="tab-content" id="resultSheetContent">
          <div id="luckysheetContainer" style="width:100%;min-height:600px;height:80vh;"></div>
        </div>

      </div>
    </div>
  </main>
</div>
{% endblock %}
