<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DB 시험 이력 조회</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    
</head>
<body>
    <div class="container mx-auto p-4">
        <div class="header p-4 mb-4 rounded">
            <h1 class="text-2xl font-bold">DB 시험 이력 조회</h1>
        </div>
        
        <div class="flex">
            <!-- 좌측 검색 조건 패널 -->
            <div class="search-panel p-4 rounded mr-4">
                <h2 class="text-lg font-bold mb-4 text-blue-900">검색 조건 설정</h2>
                
                <div id="search-conditions">
                    <!-- 검색 조건 1 -->
                    <div class="condition-row">
                        <div class="delete-condition" onclick="deleteThisCondition(this)">
                            <i class="fas fa-times"></i>
                        </div>
                        <div class="flex items-center mb-2">
                            <select class="field-select w-full p-2 mr-2 border rounded" onchange="checkDateField(this)">
                                <option value="">컬럼 선택</option>
                                <option value="certDate">인증일자</option>
                                <option value="certNumber">인증번호</option>
                                <option value="testNumber">시험번호</option>
                                <option value="swCategory">SW분류</option>
                                <option value="companyName">회사명</option>
                                <option value="productName">제품명</option>
                                <option value="productDesc">제품 개요</option>
                                <option value="startEndDate">시작/종료 날짜</option>
                                <option value="wd">WD</option>
                            </select>
                        </div>
                        <div class="flex items-center">
                            <div class="w-full relative">
                                <input type="text" class="field-value w-full p-2 border rounded" placeholder="검색어 입력">
                                <i class="date-icon fas fa-calendar absolute right-2 top-2 text-gray-500 hidden"></i>
                            </div>
                        </div>
                        <div class="date-buttons justify-between mt-2 text-xs">
                            <button class="btn-period px-2 py-1 rounded">3년</button>
                            <button class="btn-period px-2 py-1 rounded">5년</button>
                            <button class="btn-period px-2 py-1 rounded">7년</button>
                            <button class="btn-period px-2 py-1 rounded">10년</button>
                        </div>
                    </div>
                    
                    <!-- 검색 조건 2 -->
                    <div class="condition-row">
                        <div class="delete-condition" onclick="deleteThisCondition(this)">
                            <i class="fas fa-times"></i>
                        </div>
                        <div class="flex items-center mb-2">
                            <select class="field-select w-full p-2 mr-2 border rounded" onchange="checkDateField(this)">
                                <option value="">컬럼 선택</option>
                                <option value="certDate">인증일자</option>
                                <option value="certNumber">인증번호</option>
                                <option value="testNumber">시험번호</option>
                                <option value="swCategory">SW분류</option>
                                <option value="companyName">회사명</option>
                                <option value="productName">제품명</option>
                                <option value="productDesc">제품 개요</option>
                                <option value="startEndDate">시작/종료 날짜</option>
                                <option value="wd">WD</option>
                            </select>
                        </div>
                        <div class="flex items-center">
                            <div class="w-full relative">
                                <input type="text" class="field-value w-full p-2 border rounded" placeholder="검색어 입력">
                                <i class="date-icon fas fa-calendar absolute right-2 top-2 text-gray-500 hidden"></i>
                            </div>
                        </div>
                        <div class="date-buttons justify-between mt-2 text-xs">
                            <button class="btn-period px-2 py-1 rounded">3년</button>
                            <button class="btn-period px-2 py-1 rounded">5년</button>
                            <button class="btn-period px-2 py-1 rounded">7년</button>
                            <button class="btn-period px-2 py-1 rounded">10년</button>
                        </div>
                    </div>
                </div>
                
                <div class="flex mt-4 justify-center">
                    <button class="btn-add-condition p-2 rounded w-full" onclick="addCondition()">
                        <i class="fas fa-plus mr-1"></i> 조건 추가
                    </button>
                </div>
                
                <div class="mt-8">
                    <button class="btn-search w-full p-3 rounded font-bold" onclick="searchData()">
                        <i class="fas fa-search mr-2"></i> 검색
                    </button>
                </div>
            </div>
            
            <!-- 우측 검색 결과 패널 -->
            <div class="result-panel bg-white p-4 rounded shadow">
                <h2 class="text-lg font-bold mb-4 text-blue-900">검색 결과</h2>
                
                <div class="mb-2 text-right table-info">
                    총 <span id="total-count">100</span>건 | <span id="page-info">1-20</span> 표시
                </div>
                
                <div class="table-container border rounded">
                    <table class="w-full border-collapse" id="result-table">
                        <thead>
                            <tr>
                                <th class="p-3 border sticky top-0">인증일자</th>
                                <th class="p-3 border sticky top-0">인증번호</th>
                                <th class="p-3 border sticky top-0">시험번호</th>
                                <th class="p-3 border sticky top-0">SW분류</th>
                                <th class="p-3 border sticky top-0">회사명</th>
                                <th class="p-3 border sticky top-0">제품명</th>
                                <th class="p-3 border sticky top-0">시작일자</th>
                                <th class="p-3 border sticky top-0">종료일자</th>
                                <th class="p-3 border sticky top-0">WD</th>
                            </tr>
                        </thead>
                        <tbody id="result-body">
                            <!-- 데이터는 JavaScript로 동적 생성됩니다 -->
                        </tbody>
                    </table>
                </div>
                
                <div class="mt-4 flex justify-between items-center">
                    <div class="text-sm text-gray-600">
                        페이지당 행: <strong>20</strong>
                    </div>
                    <nav class="flex items-center" id="pagination">
                        <a href="#" class="px-3 py-1 rounded-l border border-blue-900 text-blue-900 hover:bg-blue-900 hover:text-white pagination-button" data-action="first">
                            <i class="fas fa-angle-double-left"></i>
                        </a>
                        <a href="#" class="px-3 py-1 border-t border-b border-blue-900 text-blue-900 hover:bg-blue-900 hover:text-white pagination-button" data-action="prev">
                            <i class="fas fa-angle-left"></i>
                        </a>
                        <div id="page-numbers" class="flex">
                            <!-- 페이지 번호는 JavaScript로 동적 생성됩니다 -->
                        </div>
                        <a href="#" class="px-3 py-1 border-t border-b border-blue-900 text-blue-900 hover:bg-blue-900 hover:text-white pagination-button" data-action="next">
                            <i class="fas fa-angle-right"></i>
                        </a>
                        <a href="#" class="px-3 py-1 rounded-r border border-blue-900 text-blue-900 hover:bg-blue-900 hover:text-white pagination-button" data-action="last">
                            <i class="fas fa-angle-double-right"></i>
                        </a>
                    </nav>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // 전역 변수 설정
        const ROWS_PER_PAGE = 20;
        let currentPage = 1;
        let totalData = [];
        let totalPages = 0;
        
        // 데이터 초기화 및 페이지 렌더링
        document.addEventListener('DOMContentLoaded', function() {
            generateDummyData();
            renderPage(1);
            setupPagination();
        });

        // 더미 데이터 생성
        function generateDummyData() {
            const swTypes = ['응용 소프트웨어', '시스템 소프트웨어', '데이터베이스', '보안 소프트웨어', '임베디드 소프트웨어', '웹 애플리케이션', '모바일 앱', '게임 소프트웨어', '클라우드 솔루션'];
            const companies = ['(주)소프트솔루션', '(주)테크시스', '데이터코어(주)', '시큐어테크(주)', '(주)임베딩크', '클라우드웨어(주)', '스마트시스템(주)', '모바일테크(주)', '(주)넥스트소프트'];
            const products = ['클라우드 매니저', '서버 모니터링 시스템', '분산 데이터베이스', '엔드포인트 보안 솔루션', 'IoT 디바이스 컨트롤러', '웹 서비스 플랫폼', '모바일 백엔드 시스템', '데이터 분석 도구', '스마트 팩토리 솔루션'];
            
            for (let i = 1; i <= 100; i++) {
                const year = 2025 - Math.floor(Math.random() * 3);
                const month = Math.floor(Math.random() * 12) + 1;
                const day = Math.floor(Math.random() * 28) + 1;
                
                const certDate = `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                
                const startYear = year - Math.floor(Math.random() * 2);
                const startMonth = Math.floor(Math.random() * 12) + 1;
                const startDay = Math.floor(Math.random() * 28) + 1;
                
                const startDate = `${startYear}-${startMonth.toString().padStart(2, '0')}-${startDay.toString().padStart(2, '0')}`;
                const endDate = `${year}-${month.toString().padStart(2, '0')}-${Math.min(day + 15, 28).toString().padStart(2, '0')}`;
                
                totalData.push({
                    certDate: certDate,
                    certNumber: `CERT-${year}-${i.toString().padStart(3, '0')}`,
                    testNumber: `TEST-${i.toString().padStart(3, '0')}`,
                    swCategory: swTypes[Math.floor(Math.random() * swTypes.length)],
                    companyName: companies[Math.floor(Math.random() * companies.length)],
                    productName: `${products[Math.floor(Math.random() * products.length)]} v${Math.floor(Math.random() * 5) + 1}.${Math.floor(Math.random() * 10)}`,
                    startDate: startDate,
                    endDate: endDate,
                    wd: `WD${i.toString().padStart(3, '0')}`
                });
            }
            
            totalPages = Math.ceil(totalData.length / ROWS_PER_PAGE);
            document.getElementById('total-count').textContent = totalData.length;
        }
        
        // 페이지 렌더링
        function renderPage(page) {
            currentPage = page;
            const start = (page - 1) * ROWS_PER_PAGE;
            const end = Math.min(start + ROWS_PER_PAGE, totalData.length);
            
            const tableBody = document.getElementById('result-body');
            tableBody.innerHTML = '';
            
            for (let i = start; i < end; i++) {
                const row = document.createElement('tr');
                const item = totalData[i];
                
                row.innerHTML = `
                    <td class="p-3 border">${item.certDate}</td>
                    <td class="p-3 border">${item.certNumber}</td>
                    <td class="p-3 border">${item.testNumber}</td>
                    <td class="p-3 border">${item.swCategory}</td>
                    <td class="p-3 border">${item.companyName}</td>
                    <td class="p-3 border">${item.productName}</td>
                    <td class="p-3 border">${item.startDate}</td>
                    <td class="p-3 border">${item.endDate}</td>
                    <td class="p-3 border">${item.wd}</td>
                `;
                
                tableBody.appendChild(row);
            }
            
            // 페이지 정보 업데이트
            document.getElementById('page-info').textContent = `${start + 1}-${end}`;
            
            // 페이지 버튼 활성화 상태 업데이트
            updatePaginationButtons();
        }
        
        // 페이지네이션 설정
        function setupPagination() {
            const pageNumbers = document.getElementById('page-numbers');
            pageNumbers.innerHTML = '';
            
            // 페이지 번호 생성
            updatePageNumbers();
            
            // 페이지네이션 버튼 이벤트 설정
            document.querySelectorAll('.pagination-button[data-action]').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    const action = this.getAttribute('data-action');
                    
                    switch (action) {
                        case 'first':
                            renderPage(1);
                            break;
                        case 'prev':
                            if (currentPage > 1) renderPage(currentPage - 1);
                            break;
                        case 'next':
                            if (currentPage < totalPages) renderPage(currentPage + 1);
                            break;
                        case 'last':
                            renderPage(totalPages);
                            break;
                    }
                    
                    updatePageNumbers();
                });
            });
        }
        
        // 페이지 번호 업데이트
        function updatePageNumbers() {
            const pageNumbers = document.getElementById('page-numbers');
            pageNumbers.innerHTML = '';
            
            // 표시할 페이지 범위 계산
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, startPage + 4);
            
            if (endPage - startPage < 4) {
                startPage = Math.max(1, endPage - 4);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageButton = document.createElement('a');
                pageButton.href = '#';
                pageButton.className = `px-3 py-1 border-t border-b border-blue-900 text-blue-900 hover:bg-blue-900 hover:text-white pagination-button ${i === currentPage ? 'active' : ''}`;
                pageButton.textContent = i;
                
                pageButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    renderPage(i);
                    updatePageNumbers();
                });
                
                pageNumbers.appendChild(pageButton);
            }
        }
        
        // 페이지네이션 버튼 상태 업데이트
        function updatePaginationButtons() {
            const prevButtons = document.querySelectorAll('.pagination-button[data-action="first"], .pagination-button[data-action="prev"]');
            const nextButtons = document.querySelectorAll('.pagination-button[data-action="last"], .pagination-button[data-action="next"]');
            
            prevButtons.forEach(button => {
                button.classList.toggle('opacity-50', currentPage === 1);
            });
            
            nextButtons.forEach(button => {
                button.classList.toggle('opacity-50', currentPage === totalPages);
            });
        }
        
        // 검색 기능
        function searchData() {
            // 실제 검색 기능 구현은 백엔드와 연동 필요
            // 여기서는 더미 데이터를 다시 생성하고 첫 페이지로 이동하는 것으로 시뮬레이션
            totalData = [];
            generateDummyData();
            renderPage(1);
            setupPagination();
            alert('검색이 완료되었습니다.');
        }
        
        // 날짜 필드 확인 및 날짜 UI 표시
        function checkDateField(select) {
            const row = select.closest('.condition-row');
            const dateIcon = row.querySelector('.date-icon');
            const dateButtons = row.querySelector('.date-buttons');
            const input = row.querySelector('.field-value');
            
            if (select.value === 'certDate' || select.value === 'startEndDate') {
                dateIcon.classList.remove('hidden');
                row.classList.add('date-condition');
                input.type = 'date';
            } else {
                dateIcon.classList.add('hidden');
                row.classList.remove('date-condition');
                input.type = 'text';
            }
        }
        
        // 개별 조건 삭제
        function deleteThisCondition(button) {
            const conditions = document.getElementById('search-conditions');
            const conditionRow = button.closest('.condition-row');
            
            // 최소 1개의 조건은 유지
            if (conditions.children.length > 1) {
                conditions.removeChild(conditionRow);
            } else {
                alert('최소 1개의 검색 조건이 필요합니다.');
            }
        }
        
        // 조건 추가
        function addCondition() {
            const conditions = document.getElementById('search-conditions');
            const newCondition = document.createElement('div');
            newCondition.className = 'condition-row';
            newCondition.innerHTML = `
                <div class="delete-condition" onclick="deleteThisCondition(this)">
                    <i class="fas fa-times"></i>
                </div>
                <div class="flex items-center mb-2">
                    <select class="field-select w-full p-2 mr-2 border rounded" onchange="checkDateField(this)">
                        <option value="">컬럼 선택</option>
                        <option value="certDate">인증일자</option>
                        <option value="certNumber">인증번호</option>
                        <option value="testNumber">시험번호</option>
                        <option value="swCategory">SW분류</option>
                        <option value="companyName">회사명</option>
                        <option value="productName">제품명</option>
                        <option value="productDesc">제품 개요</option>
                        <option value="startEndDate">시작/종료 날짜</option>
                        <option value="wd">WD</option>
                    </select>
                </div>
                <div class="flex items-center">
                    <div class="w-full relative">
                        <input type="text" class="field-value w-full p-2 border rounded" placeholder="검색어 입력">
                        <i class="date-icon fas fa-calendar absolute right-2 top-2 text-gray-500 hidden"></i>
                    </div>
                </div>
                <div class="date-buttons justify-between mt-2 text-xs">
                    <button class="btn-period px-2 py-1 rounded">3년</button>
                    <button class="btn-period px-2 py-1 rounded">5년</button>
                    <button class="btn-period px-2 py-1 rounded">7년</button>
                    <button class="btn-period px-2 py-1 rounded">10년</button>
                </div>
            `;
            conditions.appendChild(newCondition);
        }
    </script>
</body>
</html>
